<section class="viewport px-3">
  <section
    class="pool mt-4 mb-5 py-2"
    [style.width.rem]="(21 + 1) * displayOrder.length"
    *ngIf="!loading"
  >
    <div class="swimlane mr-3" *ngFor="let stateName of displayOrder">
      <header>
        <h2 class="h4 d-inline mr-1">{{ stateName | titlecase }}</h2>
        <span>({{ displayGroups[stateName]?.length || 0 }})</span>
      </header>
      <div class="y-scroll py-3">
        <div *ngFor="let story of displayGroups[stateName]">
          <button class="btn p-0 mb-3 w-100" (click)="openStoryModal(story)">
            <article
              class="card text-left"
              [ngClass]="{
                'alert-warning': story.story_type === 'feature',
                'alert-danger': story.story_type === 'bug',
                'alert-secondary': story.story_type === 'chore'
              }"
            >
              <header class="card-body">
                <h3 class="h5">{{ story.name }}</h3>
              </header>
              <div class="card-body pt-0">
                <div class="d-flex flex-row">
                  <span class="badge badge-light mr-1 mb-2">
                    <i
                      class="fas"
                      [ngClass]="{
                        'fa-star text-warning': story.story_type === 'feature',
                        'fa-bug text-danger': story.story_type === 'bug',
                        'fa-wrench text-secondary':
                          story.story_type === 'chore',
                        'fa-rocket text-secondary':
                          story?.story_type === 'release'
                      }"
                    ></i>
                    {{ story.story_type }}
                  </span>
                  <span class="badge badge-secondary mr-1 mb-2">{{
                    story.requester?.name || '--'
                  }}</span>
                  <span class="badge badge-info mb-2">
                    <i class="fas fa-signal"></i>
                    {{ story.estimate || 'unestimated' }}
                  </span>
                </div>
                <div class="d-flex flex-row flex-wrap">
                  <span
                    class="badge badge-dark badge-label mr-1 mb-2"
                    [title]="label.name"
                    *ngFor="let label of story.labels"
                    >{{ label.name }}
                  </span>
                </div>
                <div class="d-flex flex-row-reverse">
                  <span
                    class="badge badge-primary mt-2 mr-1"
                    *ngFor="let owner of story.owners"
                    [title]="owner?.name"
                    >{{ owner?.initials | uppercase }}
                  </span>
                </div>
              </div>
            </article>
          </button>
        </div>
      </div>
    </div>
  </section>
</section>

<ng-template #storyModal let-modal>
  <header class="modal-header align-items-center border-bottom-0">
    <h4 class="modal-title">{{ focusedStory?.name }}</h4>
    <button
      type="button"
      class="close"
      aria-label="Close"
      (click)="modal.dismiss()"
    >
      <i aria-hidden="true" class="fas fa-times"></i>
    </button>
  </header>
  <div class="modal-body container-fluid">
    <pt-story-details
      [story]="focusedStory"
      [loading]="focusedStoryLoading"
    ></pt-story-details>
  </div>
</ng-template>
